<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
  <style>
    html,
    body {
      padding: 0;
      margin: 0;
      width: 100%;
      height: 100%;
      position: fixed;
      overflow: hidden;
      text-align: center;
      background: black;
    }

    img {
      height: 100%;
    }
  </style>
</head>

<body>
  <script>
    let params = (window.location.search || '').replace(/^\?/, '')
      .split('&')
      .map(x => x.split('=').map(decodeURIComponent))
      .reduce((acc, [a, b]) => {
        acc[a] = b;
        return acc;
      }, {});

    function reload(img, wait = 0, recurse = false) {
      let src = img.src.replace(/=.+/, Date.now())
      img.src = '';
      setTimeout(() => {
        img.src = src;
        if (recurse && !!img.parentNode) {
          reload(img, wait, recurse);
        }
      }, 100 + wait);
    }

    let img = document.createElement('img');
    img.src = 'https://storage.googleapis.com/' + params.appId + '/images/door-snap.jpg?cache=';
    img.remove = img.remove.bind(img);
    document.body.appendChild(img);

    let img2 = document.createElement('img');
    img2.src = 'http://' + params.ip + '/camera/stream';
    img2.addEventListener('load', img.remove);
    img2.addEventListener('error', function onError() {
      img2.remove();
      img2.removeEventListener('load', img.remove);
      img2.removeEventListener('error', onError);
    });
    document.body.appendChild(img2);

    reload(img, 2000, true);
  </script>
</body>

</html>